<!DOCTYPE html>




 <html class="no-js"> 
<head>

<script type="text/javascript">
theBaseUrl = "http://vamp.io/";
</script>
<base href="http://vamp.io/" />

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
  <title>Deploy your first blueprint - Vamp</title>
  <meta name="generator" content="Hugo 0.16" />

  
  <meta name="description" content="Vamp - Deploy and manage microservices with power and ease.">
  
  <link rel="canonical" href="./documentation/tutorials/deploy-your-first-blueprint/">
  
  <meta name="author" content="magnetic.io">
  

  <meta property="og:url" content="/documentation/tutorials/deploy-your-first-blueprint/">
  <meta property="og:title" content="Vamp">
  <meta property="og:image" content="/images/logo.svg">
  <meta name="apple-mobile-web-app-title" content="Vamp">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="shortcut icon" type="image/x-icon" href="./images/logo.svg">
  <link rel="icon" type="image/x-icon" href="./images/logo.svg">


  <style>
    @font-face {
      font-family: 'Icon';
      src: url('fonts/icon.eot?52m981');
      src: url('fonts/icon.eot?#iefix52m981')
      format('embedded-opentype'),
      url('fonts/icon.woff?52m981')
      format('woff'),
      url('fonts/icon.ttf?52m981')
      format('truetype'),
      url('fonts/icon.svg?52m981#icon')
      format('svg');
      font-weight: normal;
      font-style: normal;
    }
  </style>

  <link rel="stylesheet" href="css/style.css">

  <script src="js/vendor.js"></script>

  <script src="js/app.js"></script>

  
</head>
<body class="palette-primary-pink palette-accent-pink">


<div class="single-page">
  <nav aria-label="Header" id="header" class="top-menu">
  <div class="left">
    <a href="./">
      <div id="logo" class="logo"></div>
    </a>
  </div>

  <div class="right">
    <div class="top-menu-items" id="top-menu-items">

    </div>

    <div class="download">
      <a href="./documentation/installation/hello-world/" class="button button--red">
        Try Vamp
      </a>
    </div>

    <a href="https://github.com/magneticio/vamp" target="_blank" class="github-logo">
      <i class="fa fa-2x fa-github" aria-hidden="true"></i>
    </a>

    <div class="search-button">
      <i class="fa fa-lg fa-search"></i>
    </div>

  </div>
</nav>

<ul id="mobile-menu" style="display: none">
</ul>

<div id="search">
  <div class="search-bar">
    <div class="search-bar__back">
      <i class="fa fa-lg fa-times"></i>
    </div>
    <input class="search-bar__input" placeholder="Type your search here...">
  </div>
  <div class="search-results">
    <ul></ul>
  </div>
</div>


</div>

<div class="page documentation">
    <div class="menu" id="side-menu">
    </div>
    <div class="content">
      <h1 class="content-header">Deploy your first blueprint </h1>
      <div class="markdowned">
        

<h2 id="overview">Overview</h2>

<p>If everything went to plan, you should have your Vamp installation up and running. If not, please follow the <a href="./documentation/installation/hello-world">Vamp hello world</a> quick setup steps. Now we&rsquo;re ready to check out some of Vamp&rsquo;s features.</p>

<h4 id="in-this-tutorial-we-will">In this tutorial we will:</h4>

<ol>
<li>Deploy a monolith, using either the Vamp UI or the Vamp API</li>
<li>Check out the deployed application<br /></li>
<li>Get some metrics on the running application<br /></li>
<li>Change the scale and load-balancing</li>
<li>Chaos monkey!<br /></li>
</ol>

<h2 id="in-depth">In depth</h2>

<h3 id="step-1-deploy-a-monolith">Step 1: Deploy a monolith</h3>

<p>Imagine you or the company you work for still use monolithic applications. I know, it sounds far fetched&hellip;
This application is conveniently called <em>Sava monolith</em> and is at version 1.0.</p>

<p>You&rsquo;ve managed to wrap your monolith in a Docker container, which lives in the Docker hub under <code>magneticio/sava:1.0.0</code>. Your app normally runs on port <code>8080</code> but you want to expose it under port <code>9050</code> in this case. Let&rsquo;s deploy this through Vamp using the following simple blueprint. Don&rsquo;t worry too much about what means what: we&rsquo;ll get there.</p>

<pre><code class="language-yaml">---
name: sava:1.0
gateways:
  9050: sava/webport
clusters:
  sava:
    services:
      breed:
        name: sava:1.0.0
        deployable: magneticio/sava:1.0.0
        ports:
          webport: 8080/http
      scale:
        cpu: 0.2       
        memory: 64MB
        instances: 1
</code></pre>

<h4 id="deploy-using-the-vamp-ui">Deploy using the Vamp UI</h4>

<ol>
<li><p>In the Vamp UI, go to the <strong>blueprints</strong> tab, click the <strong>+ Create</strong> button. Paste in the above blueprint and press <strong>+ Create</strong>.</p>

<ul>
<li>Vamp will store the blueprint and make it available for deployment.
<br /></li>
</ul></li>

<li><p>Press the <strong>Deploy as</strong> button.</p>

<ul>
<li>You&rsquo;ll be prompted to give your deployment a name, let&rsquo;s call it <strong>sava</strong>
<br /></li>
</ul></li>

<li><p>Press <strong>Deploy</strong>.</p></li>
</ol>

<p><img src="./images/screens/tut1_deploy-v090.gif" alt="" /></p>

<h4 id="deploy-using-the-vamp-api">Deploy using the Vamp API</h4>

<p>You can use your favorite tools like Postman (<a href="https://www.getpostman.com/">getpostman.com</a>), HTTPie (<a href="https://github.com/jakubroztocil/httpie">github.com/jakubroztocil - httpie</a>) or Curl to post this blueprint directly to the <code>api/v1/deployments</code> endpoint of Vamp.</p>

<div class="admonition note">
  <p class="admonition-title">Note!</p>
  <p><ul>
<li>Take care to set the correct <code>Content-Type: application/x-yaml</code> header on the POST request. Vamp is kinda
strict with regard to content types, because we support JSON and YAML so we need to know what you are sending.<br /></li>
<li>If you run on Docker machine, use <code>docker-machine ip default</code> instead of <code>localhost</code>, e.g.
<code>
http POST http://`docker-machine ip default`:8080/api/v1/deployments Content-Type:application/x-yaml &lt; sava_1.0.yaml
</code></li>
</ul>
</p>
</div>

<ul>
<li><p>Using <code>curl</code></p>

<pre><code>curl -v -X POST --data-binary @sava_1.0.yaml -H &quot;Content-Type: application/x-yaml&quot; http://localhost:8080/api/v1/deployments
</code></pre></li>

<li><p>Using <code>httpie</code></p>

<pre><code>http POST http://localhost:8080/api/v1/deployments Content-Type:application/x-yaml &lt; sava_1.0.yaml
</code></pre></li>
</ul>

<p>After POST-ing, Vamp should respond with a <code>202 Accepted</code> message and return a JSON blob. This means Vamp is trying to deploy your container. You&rsquo;ll notice some parts are filled in for you, like a default scale, a default routing and of course a UUID as a name.</p>

<div class="admonition tip">
  <p class="admonition-title"></p>
  <p>You can use the RESTful API to create a deployment with a custom name - simple <code>PUT</code> request to <code>http://localhost:8080/api/v1/deployments/DEPLOYMENT_CUSTOM_NAME</code></p>
</div>

<h3 id="step-2-check-out-the-deployed-application">Step 2: Check out the deployed application</h3>

<p>You can follow the deployment process of our container by checking the <code>/api/v1/deployments</code> endpoint and checking when the <code>state</code> field changes from <code>ReadyForDeployment</code> to <code>Deployed</code>. You can also check Marathon&rsquo;s GUI.</p>

<p>When the application is fully deployed you can check it out at Vamp host address + the port that was assigned in the blueprint, e.g: <code>http://10.26.184.254:9050/</code>. It should report a refreshing hipster lorem ipsum (<a href="http://hipsterjesus.com/">hipsterjesus.com</a>) upon each reload.</p>

<p><img src="./images/screens/monolith1.png" alt="" /></p>

<h3 id="step-3-get-some-metrics-on-the-running-application">Step 3: Get some metrics on the running application</h3>

<p>Using a simple tool like Apache Bench (<a href="https://httpd.apache.org/docs/2.2/programs/ab.html">apache - ab</a>) we can put some load on our application and see some of the metrics flowing into the dashboard. Use the following command to send 10000 requests using 15 threads to our Sava app.</p>

<pre><code class="language-bash">ab -k -c 15 -n 10000 http://localhost:9050/
</code></pre>

<p>or</p>

<pre><code class="language-bash">ab -k -c 15 -n 10000 http://`docker-machine ip default`:9050/
</code></pre>

<p>You should see the metrics spike and some pretty charts being drawn:</p>

<p><img src="./images/screens/tut1_metrics-v090.gif" alt="" /></p>

<h3 id="step-4-change-scale-and-load-balancing">Step 4: Change scale and load-balancing</h3>

<p>Vamp will automatically load-balance services. Let&rsquo;s change the scale of the service by selecting &ldquo;3&rdquo; in the <strong>instances</strong> field. Now Vamp will automatically scale up the number of running instances (of course permitting underlying resources) and load-balance these to the outside world using the gateway feature.</p>

<p><img src="./images/screens/tut1_scale-v090.gif" alt="" /></p>

<h3 id="step-5-chaos-monkey">Step 5: Chaos monkey</h3>

<p>Now let&rsquo;s try something fun. Go to the Marathon UI (on port 9090) and find the Sava container running. Now select destroy to kill the container. Watch Vamp detecting that issue and making sure that the defined number of instances is spun up again as soon as possible, while making sure the loadbalancing routing rules are also updated to reflect the changed IP&rsquo;s and ports of the instances.</p>

<div class="admonition note">
  <p class="admonition-title">What next?</p>
  <p><ul>
<li>Let&rsquo;s <a href="./documentation/tutorials/run-a-canary-release/">run a canary release in the second part of this getting started tutorial →</a></li>
</ul>
</p>
</div>

      </div>
    </div>
</div>

<div class="lander-row lander-row--blue footer">
  <div class="container">
    <div class="row">
      <div class="col col-3">
        <h2 class="h2">Learn more</h2>
        <a href="./why-use-vamp/">
          <p class="text">Why use Vamp?</p>
        </a>
        <a href="./documentation/how-vamp-works/architecture-and-components">
          <p class="text">Documentation</p>
        </a>
        <a href="./about/">
          <p class="text">About us</p>
        </a>
        <a href="./resources/news/">
          <p class="text">News</p>
        </a>
        <a href="./contact/">
          <p class="text">Contact</p>
        </a>
      </div>
        <div class="col col-6">
        <h2 class="h2">All things code</h2>
          <a href="./support/">
            <p class="text">Support</p>
          </a>
          <a href="./resources/community/">
            <p class="text">Community</p>
          </a>
          <a href="https://github.com/magneticio/vamp" target="_blank">
            <p class="text">GitHub</p>
          </a>
          <a href="https://gitter.im/magneticio/vamp" target="_blank">
            <p class="text">Gitter</p>
          </a>
      </div>
      <div class="col col-6">
        <h2 class="h2">Stay up to date</h2>
        <p class="text">
          Leave your email for the latest news: We won’t spam you and won’t go off topic.
        </p>

        <form action="//magnetic.us9.list-manage.com/subscribe/post?u=c709b3ab8cce9e00d617e01b6&amp;id=c1465e21d0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate form-inline" style="display: inline" target="_blank" novalidate="">
          <div class="input-group">
            <input type="email" name="EMAIL" id="mce-EMAIL" placeholder="Email">
            <a onclick="$(this).closest('form').submit()" class="button button--red not-active">
              <div class="button__icon button__icon--mail">
              </div>
            </a>
          </div>
        </form>

        
          
        


        <div class="social-buttons">
          <p class="text">Follow us on: </p>
          <a href="https://twitter.com/vamp_io" target="_blank">
            <i class="fa fa-2x fa-twitter"></i>
          </a>

          <a href="https://www.linkedin.com/company/magnetic-io" target="_blank">
            <i class="fa fa-2x fa-linkedin"></i>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="footer-bottom lander-row--blue">
  <div class="container">
    <div class="part">
      <a href="./about/"><img class="magnetic-logo" src="./img/005-vamp/Logo/magnetic-logo-footer.svg" alt=""></a>
    </div>
    <div class="part">
      <img class="vamp-bat" src="./img/003-Small-icons/Medium-blue/VAMP-Medium.svg" alt="">
      <p class="text">Code licensed under <a type="application/rss+xml" href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache 2</a> © 2016 <a href="./about/">Magnetic.io</a></p>
    </div>
  </div>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59948816-1', 'auto');
  ga('send', 'pageview');

</script>

