
---
date: 2016-09-13T09:00:00+00:00
title: Create and measure events using Vamp workflows and the Vamp API
draft: true
---



In this tutorial we will:

1. Create a simple workflow
* Create Vamp events using the REST API

### Requirements

* A running version of Vamp 0.9.x (this tutorial has been tested on the [Vamp hello world set up](documentation/installation/hello-world) using Vamp 0.9.1)
  
## Create a hello world workflow
Explain what a workflow is, why we use them and how they are created...

* you can automate Vamp with any application (e.g. something developed in python), as long as it can count or trigger an action against the Vamp API. 
* Vamp workflows are a convenient way of creating Node JS based scripts that run as containers and access the Vamp API.
* Workflows can be scheduled to run as a deamon, be triggered by events or run at specified timestamp.
* The workflow driver is used for time based and event based workflows
* Create a workflow, referencing the breed - this is best practice.

### Create a breed 
Here we're going to add our JavaScript. There are few items that we need to include so we can interact with Vamp

```
name: helloworkflow
kind: breed
deployable:
  type: application/javascript
  definition: |
    'use strict';

    var vamp = require('vamp-node-client');

    var api = new vamp.Api(); //create new Vamp API object

    var period = 5;  // milliseconds

    var run = function () {
         api.event('hello world', 'from Vamp10sec', 'my_type'); //tag, value, type
     };

    run();

    setInterval(run, period * 1000); //run this workflow every x seconds, x defined in period var
ports: {}
environment_variables: {}
constants: {}
arguments: []
dependencies: {}
```

### Deploy hello workflow
When we create a workflow that references a breed of `type application/javascript` it will be deployed in a Vamp workflow agent container. 

```

```
Scheduled to run as a daemon, so you can immediately see the created events appearing in the Vamp UI EVENTS stream. 

![](images/screens/v091/events_vampui_events.png)

### Update the running workflow
If we wanted to update our workflow...
Not a necesary step, but worth noting how we need to update a running workflow. Updating the breed alone won't do it, you need to make a nominal change to the workflow itself and then save it - this will cause the workflow to be re-deployed, including any changes saved in the breed. Restart workflow features will be added soon. 

## All about events
Vamp is a distributed system. The events stream ties everything together. For example, canary release is based on metrics events. Gateways are updated based on deployments (synchronisation events). Health and metrics are values generated by workflows and flowing through the events system. Health is used for the UI.

Read the [basic event rules](documentation/using-vamp/events/#basic-event-rules)

* The Vamp API has a method "event" which can initiate API actions based on events. See [using events](documentation/usint-vamp/events) Think ['tag1:value', 'tag2:value'] type
* You can create custom types
* Tags and values are key value pairs. There is only room for one unique key, if you use the same key two times it must have a unique value. Think ['test:1', 'test:2'] and not ['test', 'test:1'] although this is ok ['test', 'retest:1']
* There is currently no authentication, using authentication headers to authenticate against the Vamp API is planned for the Vamp Enterprise Edition - [contact us for details](why-use-vamp/enterprise-edition/)
* our hello workflow is busy creating events, we can also create events from the rest api.

### Create an event using the Vamp rest API
Use postman or curl.  
See [using events](documentation/usint-vamp/events) Think `['tag1:value', 'tag2:value'] type`

Adjust below as required...
```
{
  "tags": [
    "deployments",
    "deployments:6ce79a33-5dca-4eb2-b072-d5f65e4eef8a",
    "archiving",
    "archiving:create"
  ],
  "value": "name: sava",
  "timestamp": "2015-04-21T09:15:42Z"
}
```

### Query the API to measure events
Can do this in brower. you can use `?type=`, `?tag=` or `?value=` to search through events.






## Summing up
We created our first workflow and showed how the Vamp events stream is central to Vamp. 

## Looking for more of a challenge?
Just for fun, you could try these:

* 
* 

{{< note title="What next?" >}}
* What would you like to see for our next tutorial? [let us know](mailto:info@magnetic.io)
* Find our more about [using Vamp](documentation/using-vamp/artifacts)
{{< /note >}}

