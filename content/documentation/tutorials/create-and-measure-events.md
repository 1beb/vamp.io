---
date: 2016-09-13T09:00:00+00:00
title: Create a workflow to automate events
menu:
  main:
    parent: "Tutorials"
    name: "Create a workflow to automate events"
    weight: 80
draft: true
---


This tutorial will explain how to work with the Vamp events stream. We will create and retrieve some (custom) events using the Vamp REST API, then create a simple workflow to automate this interaction. Let's get started!

### Requirements

* A running version of Vamp 0.9.x (this tutorial has been tested on the [Vamp hello world set up](documentation/installation/hello-world) using Vamp 0.9.1)



## Vamp events
Vamp is a distributed system tied together by a central events stream. Every action in Vamp creates events, which in turn can be measured and used as triggers for new actions. For example, gateway updates are triggered by deployments (synchronisation events), while canary releases and autoscaling are based on health and metrics events. Each event created by Vamp has a type and one or more tags. Event tags are a unique combination of key and one (optional) value, for example `['event_tag1', 'event_tag2:value', 'event_tag3:value'] event_type`. Vamp works with a number of default event types, custom event types can also be created using the `events` API endpoint (more on that later).

Default event types |  Description
----------|--------
Archive     |    Store/update of static Vamp artifacts (breeds, blueprints etc.)
Synchronization | Successful matching of a desired state with an observed state (for example, a successful update from 3 to 5 running instances)
Event | Hooks (for example, succesful deploy or undeploy of a blueprint)
Health | Generated by the health workflow and used by the Vamp UI
Metrics | Generated by the metrics workflow and used by the Vamp UI
Workflow | Generated by workflows used in Vamp Runner


### Storing events

Vamp events are strored by default in Elasticsearch. Elasticsearch indexing is based on the event type and is updated for each event received by the API. Custom event types will be indexed individually. 

[Read more about events](documentation/using-vamp/events/)

  
## Use the REST API to create events

The `events` endpoint of the Vamp API can be used to create and retrieve events stored in Elasticsearch. For this demonstration, we will use the events API to create a custom event type `hello_api`.



Use postman or curl to `POST` the below JSON to `/api/v1/events`

```
{
  "tags": [
    "test_key",
    "test_key:test_value"
  ],
  "type": "hello_api"
}
```  
You will receive a response with the accepted JSON (including a timestamp) in the body. The created event will show up in the EVENTS stream at the bottom of the Vamp UI:

![](images/screens/v091/events_vampui_hello_api.png)

## Create a simple workflow
Now we know how to generate events with the Vamp API, we can take this a step further and create a simple workflow to automate the process. You can automate Vamp with any application (for example something developed in python), as long as it can count or trigger an action against the Vamp API. For this tutorial, we will create a Vamp workflow. 

Vamp workflows are a convenient way of creating Node JS based scripts that run as containers and access the Vamp API. 


Explain what a workflow is, why we use them and how they are created...

*  
* 
* Workflows can be scheduled to run as a deamon, be triggered by events or run at specified timestamp.
* The workflow driver is used for time based and event based workflows
* Create a workflow, referencing the breed - this is best practice.

### Create a breed 
Here we're going to add our JavaScript. There are few items that we need to include so we can interact with Vamp

```
name: helloworkflow
kind: breed
deployable:
  type: application/javascript
  definition: |
    'use strict';

    var vamp = require('vamp-node-client');

    var api = new vamp.Api(); //create new Vamp API object

    var period = 5;  // milliseconds

    var run = function () {
         api.event('hello world', 'from Vamp10sec', 'my_type'); //tag, value, type
     };

    run();

    setInterval(run, period * 1000); //run this workflow every x seconds, x defined in period var
ports: {}
environment_variables: {}
constants: {}
arguments: []
dependencies: {}
```

### Deploy hello workflow
When we create a workflow that references a breed of `type application/javascript` it will be deployed in a Vamp workflow agent container. 

```

```
Scheduled to run as a daemon, so you can immediately see the created events appearing in the Vamp UI EVENTS stream. 

![](images/screens/v091/events_vampui_events.png)

### Update the running workflow
If we wanted to update our workflow...
Not a necesary step, but worth noting how we need to update a running workflow. Updating the breed alone won't do it, you need to make a nominal change to the workflow itself and then save it - this will cause the workflow to be re-deployed, including any changes saved in the breed. Restart workflow features will be added soon. 



## Retrieve and filter events using the REST API
Can do this in brower. you can use `?type=`, `?tag=` or `?value=` to search through events.

the event API enables you to filter and search for specifc events with specific types, tags or values




## Summing up
We created our first workflow and showed how the Vamp events stream is central to Vamp. 

## Looking for more of a challenge?
Just for fun, you could try these:

* 
* 

{{< note title="What next?" >}}
* What would you like to see for our next tutorial? [let us know](mailto:info@magnetic.io)
* Find our more about [using Vamp](documentation/using-vamp/artifacts)
{{< /note >}}

